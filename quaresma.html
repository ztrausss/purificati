<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quaresma de São Miguel Arcanjo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .bg-pattern {
            background-image: url('data:image/svg+xml,%3Csvg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M50 0L61.8 38.2L100 50L61.8 61.8L50 100L38.2 61.8L0 50L38.2 38.2Z" fill="%234b5563"/%3E%3C/svg%3E');
            background-size: 10px 10px;
        }
        /* Estilo para o modal de seleção de data */
        #datePickerModal {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex items-center justify-center">

    <!-- Tela de Boas-Vindas -->
    <div id="landingScreen" class="bg-gray-800 rounded-3xl p-8 md:p-16 text-center shadow-2xl max-w-lg mx-4 transition-all duration-500 ease-in-out transform">
        <div class="mb-8 animate-pulse">
            <!-- Ícone SVG de Espada e Escudo aprimorado -->
            <svg class="w-24 h-24 mx-auto text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 2L6 5v5.5c0 4.14 2.87 8.01 6 9.5 3.13-1.49 6-5.36 6-9.5V5l-6-3z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 2v10"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14 6L12 2L10 6"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 17.5v4"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20.5h4"></path>
            </svg>
        </div>
        <h1 class="text-3xl md:text-5xl font-bold text-white mb-4">Pronto para a Batalha?</h1>
        <p class="text-lg text-gray-400 mb-8">Comece sua jornada espiritual de 40 dias com São Miguel Arcanjo.</p>
        <button id="continueBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-colors duration-300 transform hover:scale-105">
            Continuar
        </button>
    </div>

    <!-- Tela de Conteúdo Principal (inicialmente oculta) -->
    <div id="mainContentScreen" class="hidden w-full max-w-3xl mx-auto p-4 md:p-8 overflow-y-auto" style="max-height: 100vh;">
        <!-- Cabeçalho com Data e Botão de Calendário -->
        <header class="flex justify-between items-center mb-6 sticky top-0 bg-gray-900 bg-opacity-90 z-10 py-4">
            <h2 id="currentDate" class="text-xl md:text-2xl font-bold text-white"></h2>
            <button id="datePickerBtn" class="p-3 bg-gray-700 hover:bg-gray-600 rounded-full shadow-md transition-colors duration-300">
                <!-- Ícone SVG de Relógio -->
                <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </button>
        </header>

        <!-- Conteúdo Litúrgico -->
        <div id="liturgyContent" class="bg-gray-800 rounded-3xl p-6 md:p-8 shadow-xl transition-all duration-500 ease-in-out transform hover:scale-[1.01]">
            <!-- O conteúdo será injetado aqui pelo JavaScript -->
        </div>
    </div>
    
    <!-- Modal de Seleção de Data -->
    <div id="datePickerModal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-3xl p-6 md:p-8 max-w-md w-full shadow-2xl">
            <h3 class="text-xl font-bold text-white mb-4 text-center">Escolha uma data</h3>
            <div id="dateList" class="grid grid-cols-2 md:grid-cols-3 gap-4 overflow-y-auto max-h-80">
                <!-- As datas serão preenchidas aqui -->
            </div>
            <button id="closeModalBtn" class="mt-6 w-full py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-full transition-colors duration-300">
                Fechar
            </button>
        </div>
    </div>

    <script>
        // Dados da liturgia. A reflexão e o texto do evangelho são gerados dinamicamente.
        const liturgiaData = [
            { date: "15 de Agosto", primary: "Solenidade da Assunção de Nossa Senhora", evangelho: "Lucas 1,39-56", tema: "A humildade e a fé de Maria, que nos elevam ao céu." },
            { date: "16 de Agosto", primary: "Sábado da 19ª Semana do Tempo Comum", evangelho: "Mateus 19,13-15", tema: "A inocência e a pureza das crianças, que nos ensinam a entrar no Reino dos Céus." },
            { date: "17 de Agosto", primary: "20º Domingo do Tempo Comum", evangelho: "Lucas 12,49-53", tema: "A radicalidade do Evangelho e a opção por seguir Jesus acima de tudo." },
            { date: "18 de Agosto", primary: "20ª Semana do Tempo Comum", evangelho: "Mateus 19,16-22", tema: "O desapego das riquezas para seguir o chamado de Jesus." },
            { date: "19 de Agosto", primary: "20ª Semana do Tempo Comum", evangelho: "Mateus 19,23-30", tema: "A confiança em Deus, pois o que é impossível para o homem é possível para Ele." },
            { date: "20 de Agosto", primary: "São Bernardo, abade e Doutor da Igreja", evangelho: "Mateus 20,1-16", tema: "A generosidade e a misericórdia de Deus, que não se pautam pela nossa lógica." },
            { date: "21 de Agosto", primary: "São Pio X, papa", evangelho: "Mateus 22,1-14", tema: "A prontidão em acolher o convite de Deus para o banquete da salvação." },
            { date: "22 de Agosto", primary: "Nossa Senhora Rainha", evangelho: "Mateus 22,34-40", tema: "O amor como o mandamento principal, que resume toda a lei e os profetas." },
            { date: "23 de Agosto", primary: "Sábado da 20ª Semana do Tempo Comum", evangelho: "Mateus 23,1-12", tema: "A importância da humildade e da coerência entre a nossa fé e as nossas atitudes." },
            { date: "24 de Agosto", primary: "21º Domingo do Tempo Comum", evangelho: "Lucas 13,22-30", tema: "O esforço para entrar pela porta estreita do Reino de Deus e a surpresa com os últimos que se tornarão os primeiros." },
            { date: "25 de Agosto", primary: "21ª Semana do Tempo Comum", evangelho: "Lucas 4,16-30", tema: "A missão de Jesus de anunciar a boa nova e o convite para sermos profetas." },
            { date: "26 de Agosto", primary: "21ª Semana do Tempo Comum", evangelho: "Lucas 4,31-37", tema: "A autoridade de Jesus sobre o mal e a certeza de que Ele nos liberta." },
            { date: "27 de Agosto", primary: "Santa Mônica", evangelho: "Lucas 4,38-44", tema: "O exemplo de Santa Mônica, que perseverou na oração e viu a graça de Deus se manifestar." },
            { date: "28 de Agosto", primary: "Santo Agostinho, bispo e Doutor da Igreja", evangelho: "Lucas 5,1-11", tema: "A conversão e o chamado a ser 'pescador de homens'." },
            { date: "29 de Agosto", primary: "Martírio de São João Batista", evangelho: "Marcos 6,17-29", tema: "A coragem de defender a verdade e a justiça, mesmo que isso custe a própria vida." },
            { date: "30 de Agosto", primary: "Sábado da 21ª Semana do Tempo Comum", evangelho: "Lucas 5,33-39", tema: "A alegria da nova aliança com Cristo, que não se prende às tradições vazias." },
            { date: "31 de Agosto", primary: "22º Domingo do Tempo Comum", evangelho: "Lucas 14,1.7-14", tema: "A humildade como caminho para a exaltação e a generosidade com os mais necessitados." },
            { date: "1 de Setembro", primary: "22ª Semana do Tempo Comum", evangelho: "Lucas 6,6-11", tema: "A liberdade de fazer o bem, mesmo em face de críticas e oposições." },
            { date: "2 de Setembro", primary: "22ª Semana do Tempo Comum", evangelho: "Lucas 6,12-19", tema: "A importância da oração para discernir a vontade de Deus." },
            { date: "3 de Setembro", primary: "São Gregório Magno, papa e Doutor da Igreja", evangelho: "Lucas 6,20-26", tema: "As bem-aventuranças, que nos mostram o caminho para a verdadeira felicidade." },
            { date: "4 de Setembro", primary: "22ª Semana do Tempo Comum", evangelho: "Lucas 6,27-38", tema: "O mandamento do amor aos inimigos, que nos chama a amar como Deus nos ama." },
            { date: "5 de Setembro", primary: "22ª Semana do Tempo Comum", evangelho: "Lucas 6,39-42", tema: "A importância da autoavaliação antes de julgar os outros." },
            { date: "6 de Setembro", primary: "Sábado da 22ª Semana do Tempo Comum", evangelho: "Lucas 6,43-49", tema: "A importância de construir a nossa vida sobre a Palavra de Deus." },
            { date: "7 de Setembro", primary: "23º Domingo do Tempo Comum", evangelho: "Lucas 14,25-33", tema: "O seguimento de Jesus exige renúncia e uma escolha radical." },
            { date: "8 de Setembro", primary: "Natividade de Nossa Senhora", evangelho: "Mateus 1,1-16.18-23", tema: "A alegria do nascimento de Maria, que anuncia a vinda do Salvador." },
            { date: "9 de Setembro", primary: "São Pedro Claver, presbítero", evangelho: "Lucas 8,19-21", tema: "A família de Deus, formada por aqueles que ouvem e praticam a Sua Palavra." },
            { date: "10 de Setembro", primary: "23ª Semana do Tempo Comum", evangelho: "Lucas 6,20-26", tema: "A sabedoria de Deus sobre a vida e a castidade, em oposição à sabedoria do mundo." },
            { date: "11 de Setembro", primary: "23ª Semana do Tempo Comum", evangelho: "Lucas 7,36-50", tema: "O amor e a misericórdia de Jesus, que perdoam e transformam a vida." },
            { date: "12 de Setembro", primary: "Santíssimo Nome de Maria", evangelho: "Lucas 8,1-3", tema: "O serviço a Jesus e o anúncio do Reino, como fizeram as mulheres que o acompanhavam." },
            { date: "13 de Setembro", primary: "São João Crisóstomo, bispo e Doutor da Igreja", evangelho: "Lucas 8,4-15", tema: "As condições do coração para receber e dar frutos da Palavra de Deus." },
            { date: "14 de Setembro (domingo): Festa da Exaltação da Santa Cruz", evangelho: "João 3,13-17", tema: "A Cruz como sinal de salvação, sacrifício e amor incondicional de Deus." },
            { date: "15 de Setembro", primary: "Nossa Senhora das Dores", evangelho: "João 19,25-27", tema: "A compaixão de Maria, que nos ensina a permanecer firmes na dor." },
            { date: "16 de Setembro", primary: "Santos Cornélio, papa, e Cipriano, bispo, mártires", evangelho: "Lucas 7,11-17", tema: "O poder de Jesus sobre a vida e a morte, trazendo esperança." },
            { date: "17 de Setembro", primary: "24ª Semana do Tempo Comum", evangelho: "Lucas 7,31-35", tema: "A dificuldade em aceitar a verdade, mesmo quando ela é evidente." },
            { date: "18 de Setembro", primary: "24ª Semana do Tempo Comum", evangelho: "Lucas 7,36-50", tema: "O amor e a misericórdia de Jesus, que perdoam e transformam vidas." },
            { date: "19 de Setembro", primary: "24ª Semana do Tempo Comum", evangelho: "Lucas 8,1-3", tema: "A ressurreição como a base de nossa fé e a certeza da vida eterna." },
            { date: "20 de Setembro", primary: "Sábado da 24ª Semana do Tempo Comum", evangelho: "Lucas 8,4-15", tema: "O solo do nosso coração precisa estar pronto para receber a Palavra de Deus." },
            { date: "21 de Setembro", primary: "25º Domingo do Tempo Comum", evangelho: "Lucas 16,1-13", tema: "A sabedoria na administração dos bens materiais e a fidelidade nas pequenas coisas." },
            { date: "22 de Setembro", primary: "25ª Semana do Tempo Comum", evangelho: "Lucas 8,16-18", tema: "Não esconda a sua fé; deixe-a brilhar para que todos vejam." },
            { date: "23 de Setembro", primary: "São Pio de Pietrelcina, presbítero", evangelho: "Lucas 8,19-21", tema: "A família de Jesus é formada por aqueles que ouvem a Palavra de Deus e a praticam." },
            { date: "24 de Setembro", primary: "25ª Semana do Tempo Comum", evangelho: "Lucas 9,1-6", tema: "A missão de anunciar o Reino de Deus e a confiança na Divina Providência." },
            { date: "25 de Setembro", primary: "25ª Semana do Tempo Comum", evangelho: "Lucas 9,7-9", tema: "A vaidade das coisas do mundo e a busca pelo que realmente importa." },
            { date: "26 de Setembro", primary: "Santos Cosme e Damião, mártires", evangelho: "Lucas 9,18-22", tema: "O seguimento de Jesus, que nos chama a tomar nossa cruz e segui-lo." },
            { date: "27 de Setembro", primary: "São Vicente de Paulo, presbítero", evangelho: "Lucas 9,43b-45", tema: "A vida de São Vicente de Paulo, que se entregou aos pobres e nos ensina a servir." },
            { date: "28 de Setembro", primary: "26º Domingo do Tempo Comum", evangelho: "Lucas 16,19-31", tema: "A urgência da conversão e a compaixão pelos que sofrem." },
            { date: "29 de Setembro", primary: "Santos Arcanjos Miguel, Gabriel e Rafael (Festa)", evangelho: "João 1,47-51", tema: "A ação dos anjos na nossa vida e a defesa contra o mal, com o auxílio de São Miguel." }
        ];

        document.addEventListener("DOMContentLoaded", () => {
            const landingScreen = document.getElementById('landingScreen');
            const mainContentScreen = document.getElementById('mainContentScreen');
            const continueBtn = document.getElementById('continueBtn');
            const datePickerBtn = document.getElementById('datePickerBtn');
            const datePickerModal = document.getElementById('datePickerModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const dateList = document.getElementById('dateList');
            const currentDateEl = document.getElementById('currentDate');
            const liturgyContentEl = document.getElementById('liturgyContent');

            // Mapeamento de meses para facilitar o trabalho com objetos Date
            const monthMap = {
                "janeiro": 0, "fevereiro": 1, "março": 2, "abril": 3, "maio": 4, "junho": 5,
                "julho": 6, "agosto": 7, "setembro": 8, "outubro": 9, "novembro": 10, "dezembro": 11
            };

            // Função para buscar o texto do Evangelho e a reflexão usando a API do Gemini
            async function fetchGospelText(gospelReference, tema) {
                // Conteúdo de carregamento
                liturgyContentEl.innerHTML = `
                    <div class="flex items-center justify-center p-8 text-yellow-400">
                        <svg class="animate-spin -ml-1 mr-3 h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>Carregando o Evangelho...</span>
                    </div>
                `;
                
                try {
                    // Novo prompt que pede o texto de forma mais simples e fácil de processar
                    const prompt = `Gere o texto completo do Evangelho de ${gospelReference}. Inclua o título "Reflexão" e uma reflexão de aproximadamente 100 palavras sobre como o tema '${tema}' se relaciona com o Evangelho.`;
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = {
                        contents: chatHistory,
                        // Não pedimos JSON para evitar erros de formatação
                    };

                    const apiKey = ""; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        console.error("Erro na API:", response.statusText);
                        throw new Error(`Erro na API: ${response.status.text}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        
                        const fullText = result.candidates[0].content.parts[0].text;
                        
                        // Lógica de divisão do texto mais confiável
                        const parts = fullText.split("Reflexão:");
                        const gospelText = parts[0].trim();
                        const reflectionText = parts[1] ? parts[1].trim() : `Não foi possível gerar a reflexão. Tema: ${tema}`;
                        
                        console.log("Conteúdo do Evangelho processado com sucesso.");
                        return { gospelText, reflectionText };
                    } else {
                        console.error("Resposta da API em formato inesperado:", result);
                        throw new Error("Resposta da API em formato inesperado.");
                    }
                } catch (error) {
                    console.error("Erro ao buscar o conteúdo da liturgia:", error);
                    return {
                        gospelText: "Não foi possível carregar o texto do Evangelho. Por favor, tente novamente mais tarde.",
                        reflectionText: `Tema para a oração: ${tema}`
                    };
                }
            }

            // Função para carregar e exibir o conteúdo na tela principal
            async function loadContentForDate(data) {
                currentDateEl.innerText = data.date;
                const content = await fetchGospelText(data.evangelho, data.tema);

                liturgyContentEl.innerHTML = `
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-3xl font-bold text-yellow-400 mb-2">${data.primary}</h3>
                            <p class="text-xl font-medium text-gray-300 mb-4">Evangelho: ${data.evangelho}</p>
                            <div class="prose prose-invert max-w-none text-gray-400">
                                <p class="text-lg">${content.gospelText}</p>
                            </div>
                        </div>
                        <div class="border-t border-gray-700 pt-6">
                            <h4 class="text-2xl font-bold text-white mb-2">Tema para a oração:</h4>
                            <p class="text-lg text-gray-400">${content.reflectionText}</p>
                        </div>
                    </div>
                `;
            }

            // Encontra o conteúdo para a data de hoje, ou o primeiro item da lista se a data não estiver no período
            function findTodayContent() {
                const today = new Date();
                const todayDay = today.getDate();
                const todayMonth = today.getMonth(); // 0-11
                
                const foundItem = liturgiaData.find(item => {
                    const parts = item.date.split(" de ");
                    const day = parseInt(parts[0], 10);
                    const month = monthMap[parts[1].toLowerCase()];
                    return day === todayDay && month === todayMonth;
                });

                return foundItem || liturgiaData[0];
            }
            
            // Popula o modal de seleção de datas
            function populateDateList() {
                dateList.innerHTML = '';
                liturgiaData.forEach(item => {
                    const dateBtn = document.createElement('button');
                    dateBtn.classList.add('bg-gray-700', 'hover:bg-blue-600', 'text-white', 'font-medium', 'py-2', 'px-4', 'rounded-full', 'shadow-md', 'transition-colors', 'duration-300', 'text-sm');
                    dateBtn.innerText = item.date;
                    dateBtn.dataset.date = item.date;
                    dateBtn.addEventListener('click', () => {
                        loadContentForDate(item);
                        datePickerModal.classList.add('hidden');
                        datePickerModal.classList.remove('flex');
                    });
                    dateList.appendChild(dateBtn);
                });
            }

            // Event listener para o botão "Continuar"
            continueBtn.addEventListener('click', () => {
                landingScreen.classList.add('hidden');
                mainContentScreen.classList.remove('hidden');
                
                const todayContent = findTodayContent();
                loadContentForDate(todayContent);
            });

            // Event listener para o botão do calendário (abre o modal)
            datePickerBtn.addEventListener('click', () => {
                datePickerModal.classList.remove('hidden');
                datePickerModal.classList.add('flex');
                populateDateList();
            });

            // Event listener para o botão "Fechar" do modal
            closeModalBtn.addEventListener('click', () => {
                datePickerModal.classList.add('hidden');
                datePickerModal.classList.remove('flex');
            });
        });
    </script>
</body>
</html>
